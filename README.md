üèÜ TRD Services - Plateforme de Paris Sportifs MicroservicesArchitecture microservices polyglotte et compl√®te pour un syst√®me de paris sportifs, int√©grant Java Spring Boot, .NET 8, Python FastAPI, Docker, Kubernetes, PostgreSQL, RabbitMQ et Keycloak.√âquipe de D√©veloppement :üë®‚Äçüíª BEKKOUCHE Mohamed Baha Eddineüë®‚Äçüíª SEGHIR Abderrazaküìë Table des Mati√®resVue d'ensembleArchitecture GlobaleCatalogue des ServicesD√©marrage RapideFonctionnalit√©s Cl√©sStack TechnologiqueURLs et PortsBases de Donn√©esStructure des √âv√©nements (RabbitMQ)üî≠ Vue d'ensembleTRD est une plateforme distribu√©e con√ßue pour la haute disponibilit√© et la scalabilit√©. Elle s√©pare les domaines m√©tiers en services autonomes communiquant via des APIs REST (synchrones) et un Bus d'√âv√©nements (asynchrones).Points forts :‚úÖ Architecture Hexagonale pour le c≈ìur m√©tier (Java).‚úÖ Pattern CQRS pour la s√©paration Lecture/√âcriture.‚úÖ SAGA Pattern pour les transactions distribu√©es (Paris ‚Üî Wallet).‚úÖ Orchestration via Gateway BFF pour l'authentification.‚úÖ IA/ML pour les recommandations personnalis√©es.‚úÖ Infrastructure compl√®te (IAM, DBs, Broker, Cache) conteneuris√©e.üèó Architecture GlobaleLe syst√®me est compos√© de 9 Microservices principaux et 4 Composants d'Infrastructure.Le sch√©ma d'architecture complet montrant les interactions entre les services Java, .NET et Python via RabbitMQ et REST.üì¶ Catalogue des Servicesüü¢ Domaine Core (Java Spring Boot)ServicePortR√¥leGateway Orchestrator:8088BFF (Backend for Frontend). Point d'entr√©e unique. G√®re l'orchestration de l'inscription (Keycloak + Account) et le routage.Account Service:8081Gestion des profils utilisateurs et historique des paris.Bet Lifecycle Service:8082Gestion de la prise de pari, validation des r√®gles (cotes, mises) et coordination SAGA.Wallet Service:8083"La Banque". Gestion des soldes, d√©p√¥ts, retraits et verrouillage des fonds (Optimistic Locking).üîµ Domaine Data & Sport (.NET 8)ServicePortR√¥leMatchOdds Service:8085Gestion du catalogue des matchs, √©quipes et cotes.Score Service:8086Worker background. Synchronise les scores en temps r√©el et publie les fins de match.Bet Result Service:8087Worker background. Calcule les r√©sultats des paris (Gagn√©/Perdu) et d√©clenche les paiements.Mock Football API:5000Simulation de l'API externe de football pour le d√©veloppement et les tests.üü° Domaine Intelligence (Python)ServicePortR√¥leRecommendation Engine:8084Moteur hybride (Contenu + Collaboratif) sugg√©rant des matchs bas√©s sur l'historique et les tendances.üöÄ D√©marrage RapidePr√©requisDocker Desktop (avec support Compose V2)GitInstallation et LancementCloner le repositorygit clone [https://github.com/votre-repo/TRD-Platform.git](https://github.com/votre-repo/TRD-Platform.git)
cd TRD-Platform
Lancer la stack compl√®tedocker-compose up -d
Cela va construire les images locales (Java/Python) et puller les images distantes (.NET/Infra).V√©rifier l'√©tatdocker-compose ps
Acc√©der aux interfacesSwagger Gateway : http://localhost:8088/swagger-ui.html (Si activ√©)RabbitMQ Manager : http://localhost:15672 (guest/guest)Keycloak Admin : http://localhost:8080 (admin/admin)Configuration Initiale (Obligatoire pour la premi√®re ex√©cution)La base de donn√©es est initialis√©e automatiquement via init-db.sql, mais Keycloak n√©cessite une configuration manuelle du Royaume si le volume est vide :Aller sur http://localhost:8080/adminCr√©er le Realm trd-realm.Cr√©er le client gateway-orchestrator (Confidential, Service Accounts Enabled).Copier le Secret et mettre √† jour le docker-compose.yml si n√©cessaire (variable APP_KEYCLOAK_ADMIN_CLIENT_SECRET).‚ú® Fonctionnalit√©s Cl√©süîê Identit√© & S√©curit√©Authentification OIDC standardis√©e via Keycloak.Inscription "One-Click" orchestr√©e par la Gateway (cr√©ation Keycloak + Profil M√©tier).Split Horizon Security : Configuration r√©seau avanc√©e pour g√©rer la validation des tokens entre Docker et l'H√¥te.üí∞ Finance & ParisTransaction SAGA : La prise de pari est une transaction distribu√©e (Bet Service ‚áÑ Wallet Service) via RabbitMQ.Cotes Fixes : Les cotes sont fig√©es au moment du pari (Snapshot).Paris Combin√©s : Support des accumulateurs avec multiplication des cotes.üß† Intelligence ArtificielleCold Start : Recommandations bas√©es sur la popularit√© globale (Redis).Personnalisation : Algorithme de similarit√© cosinus bas√© sur l'historique des tags (√âquipes, Ligues).üõ† Stack TechnologiqueCat√©gorieTechnologiesBackend CoreJava 21, Spring Boot 3.2, Hexagonal ArchitectureBackend Data.NET 8, ASP.NET Core, Entity FrameworkBackend AIPython 3.11, FastAPI, Scikit-learn, NumPyBases de Donn√©esPostgreSQL 16 (Multi-DB), Redis 7 (Cache/PubSub)MessagingRabbitMQ 3.12 (AMQP)S√©curit√©Keycloak 23 (OAuth2/OIDC)DevOpsDocker, Docker Compose, Kubernetes (Minikube)üîó URLs et PortsServiceBase URLDocumentation / UIGatewayhttp://localhost:8088/auth/login, /auth/sign-upAccounthttp://localhost:8081/api/v1/accountsBet Lifecyclehttp://localhost:8082/api/v1/betsWallethttp://localhost:8083/api/v1/walletsRecommendationhttp://localhost:8084/api/v1/recommendationsMatch Oddshttp://localhost:8085/api/matchesKeycloakhttp://localhost:8080/admin (Console)RabbitMQhttp://localhost:15672/ (Console)üóÑ Bases de Donn√©esUn seul conteneur PostgreSQL h√©berge plusieurs bases logiques pour l'isolation des donn√©es :Base de Donn√©esService Propri√©taireContenuaccount_dbAccount ServiceProfils, Logs d'activit√©wallet_dbWallet ServiceSoldes, Transactions (Ledger)bet_lifecycle_dbBet ServiceTickets, S√©lections, Statutsmatch_odds_dbMatchOdds Service√âquipes, Matchs, Cotesscore_dbScore ServiceScores temps r√©elbet_result_dbBet Result ServiceR√©sultats calcul√©skeycloak_dbKeycloakDonn√©es IAMüê∞ Structure des √âv√©nements (RabbitMQ)Le syst√®me repose sur l'Exchange principal : betting.events.exchange.Routing Key√âv√©nementProducteurConsommateursaccount.registeredNouvel utilisateurAccountWallet (Cr√©ation), Notificationbetting.lifecycle.placedPari plac√© (Pending)Bet LifecycleWallet (D√©bit), Rec Engine (Apprentissage)wallet.transaction.reservedFonds r√©serv√©s (Succ√®s/√âchec)WalletBet Lifecycle (Confirmation/Rejet)match.finishedFin du matchScore ServiceBet Result, Bet Lifecyclebetting.settlement.settledPari r√©gl√© (Gain calcul√©)Bet ResultWallet (Cr√©dit gain), Account (Historique)üß™ Tests Rapides (cURL)1. Inscription (Gateway)curl -X POST http://localhost:8088/auth/sign-up \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@trd.com",
    "password": "123",
    "firstName": "Test",
    "lastName": "User",
    "phone": "+33600000000"
  }'
2. D√©p√¥t d'argent (Wallet)curl -X POST http://localhost:8083/api/v1/wallets/deposit \
  -H "Authorization: Bearer <TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{ "amount": 100.00, "paymentReference": "ref_123" }'
3. Placer un Pari (Bet Lifecycle)curl -X POST http://localhost:8082/api/v1/bets \
  -H "Authorization: Bearer <TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{
    "stake": 10.00,
    "selections": [
      { "matchId": "m1", "marketName": "1x2", "selectionName": "Home", "odd": 1.50 }
    ]
  }'

